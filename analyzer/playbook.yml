---
- hosts: ubuntu:&analyzer
  handlers:
  - name: restart dhcp server
    service:
      name=isc-dhcp-server
      state=restarted
  vars:
    # openssl passwd -salt salty -1 wireshark
    wireshark_password: $1$salty$7jpBSJ1B8gIX/lHcNH/bw.
  tasks:
  - apt:
      name={{ item }}
      state=present
    with_items:
    - isc-dhcp-server
    - vnc4server
    - xrdp
    - wireshark
    - fluxbox
# wireshark user setup
  - copy:
      src=sudoers
      dest=/etc/sudoers
      mode=440
  - user:
      system=yes
      name=wireshark
      state=present
      password={{ wireshark_password }}
      shell=/bin/bash
  - copy:
      src={{ item.src }}
      dest={{ item.dest }}
      owner=wireshark
      group=wireshark
      mode=700
    with_items:
    - { src: xsession, dest: /home/wireshark/.xsession }
# configure DHCP server
  - copy:
      src=isc-dhcp-server
      dest=/etc/default/isc-dhcp-server
    with_items:
    - { src: isc-dhcp-server, dest: /etc/default/isc-dhcp-server }
    - { src: interfaces, dest: /etc/network/interfaces }
    - { src: dhcpd.conf, dest: /etc/dhcp/dhcpd.conf }
    notify:
    - restart dhcp server
  - service:
      name=isc-dhcp-server
      state=started

